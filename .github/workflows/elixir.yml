# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
name: Elixir Docker CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Installe Docker Compose et Just si non présents
      - name: Install Docker Compose & Just
        run: |
          sudo apt-get update
          sudo apt-get install -y docker-compose
          curl -fsSL https://just.systems/install.sh | bash -s -- --to /usr/local/bin

      # Lance l'environnement de test Docker Compose (Phoenix + DB + Redis si nécessaire)
      # - name: Compose up test
      #   run: |
      #     just compose-up-test

      # Installe Hex et les dépendances dans le container Phoenix
      # - name: Install Elixir Deps in container
      #   run: |
      #     docker exec whispr_notification \
      #       mix local.hex --force
      #     docker exec whispr_notification \
      #       mix deps.get

      # Compile et teste complètement dans le container
      # - name: Run Tests in container
      #   run: |
      #     docker exec whispr_notification \
      #       mix compile --warnings-as-errors
      #     docker exec whispr_notification \
      #       mix test
